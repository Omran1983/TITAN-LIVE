version: 1
agent_id: AGENT_WORKFLOW_CONDUCTOR
name: Workflow Conductor
runtime:
  mode: sandbox
  language: python
  entrypoint: wildfire/modules/workflow_conductor/main.py
  concurrency: 2
  timeout_ms: 300000

interfaces:
  consumes:
    - topic: az.workflow_requests
      schema: workflow_request_v1
  produces:
    - topic: az.workflow_runs
      schema: workflow_run_v1
    - topic: az.workflow_events
      schema: workflow_event_v1

permissions:
  read_scopes:
    - supabase:public.az_* # read
    - fs:wildfire/**
  write_scopes:
    - supabase:public.az_workflow_runs
    - supabase:public.az_workflow_events
    - fs:wildfire/**
  network:
    outbound_allowlist:
      - "localhost"
      - "127.0.0.1"

execution:
  retries: 2
  backoff_ms: 1500
  idempotency:
    key: "request_id"
    ttl_sec: 86400

observability:
  heartbeat_sec: 20
  metrics:
    - workflow_duration_ms
    - step_fail_rate
    - rerun_count
