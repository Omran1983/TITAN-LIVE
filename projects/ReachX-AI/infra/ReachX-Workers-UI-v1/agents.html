<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>ReachX Workers UI â€“ Agents</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="./assets/css/styles.css" />
</head>
<body class="bg-slate-950 text-slate-100">
  <header class="px-8 py-4 border-b border-slate-800 flex items-center justify-between">
    <div class="text-xl font-semibold">ReachX Workers UI</div>
    <nav class="flex gap-6 text-sm">
      <a href="./index.html">Dashboard</a>
      <a href="./employers.html">Employers</a>
      <a href="./agents.html" class="font-medium text-sky-400">Agents</a>
      <a href="./dormitories.html">Dormitories</a>
      <a href="./calls.html">Calls</a>
      <a href="./comms.html">Comms</a>
    </nav>
  </header>

  <main class="px-8 py-8 space-y-6">
    <section>
      <h1 class="text-2xl font-semibold mb-2">Agents / Countries</h1>
      <p class="text-slate-300 text-sm">
        List of country agents, the markets they cover and their current status.
      </p>
    </section>

    <section class="rounded-xl border border-slate-800 bg-slate-900/60 p-4">
      <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4 mb-4">
        <div class="flex items-center gap-2 w-full md:w-auto">
          <input id="search" type="text" placeholder="Search agents by name or country"
                 class="rounded-lg bg-slate-950/70 border border-slate-700 px-3 py-2 text-sm w-full md:w-72" />
        </div>
        <div class="flex items-center gap-2 text-xs text-slate-400">
          <span id="badge-count" class="inline-flex items-center rounded-full border border-slate-700 px-3 py-1">
            Loading...
          </span>
        </div>
      </div>

      <div class="overflow-x-auto">
        <table class="min-w-full text-sm">
          <thead class="border-b border-slate-800 text-slate-400 text-xs uppercase">
            <tr>
              <th class="text-left py-2 pr-4">Agent</th>
              <th class="text-left py-2 pr-4">Country</th>
              <th class="text-left py-2 pr-4">Phone / WhatsApp</th>
              <th class="text-left py-2 pr-4">Status</th>
            </tr>
          </thead>
          <tbody id="agents-body" class="divide-y divide-slate-800">
            <tr>
              <td colspan="4" class="py-4 text-center text-slate-500 text-xs">Loading agents...</td>
            </tr>
          </tbody>
        </table>
      </div>
    </section>
  </main>

  <script>window.SUPABASE_URL = "SUPABASE_URL_PLACEHOLDER"; window.SUPABASE_ANON_KEY = "SUPABASE_ANON_PLACEHOLDER";</script>
  <script src="./assets/js/reachx.js"></script>
  <script>
    document.addEventListener("DOMContentLoaded", async () => {
      const body = document.getElementById("agents-body");
      const searchInput = document.getElementById("search");
      const badge = document.getElementById("badge-count");
      let agents = [];

      function render(filterValue) {
        const value = (filterValue || "").toLowerCase();
        body.innerHTML = "";
        const filtered = agents.filter(a =>
          !value ||
          (a.name || "").toLowerCase().includes(value) ||
          (a.country || "").toLowerCase().includes(value)
        );

        if (!filtered.length) {
          body.innerHTML = '<tr><td colspan="4" class="py-4 text-center text-slate-500 text-xs">No agents found.</td></tr>';
          badge.textContent = "0 agents";
          return;
        }

        for (const agent of filtered) {
          const tr = document.createElement("tr");
          tr.innerHTML = 
            <td class="py-2 pr-4"></td>
            <td class="py-2 pr-4"></td>
            <td class="py-2 pr-4 text-slate-300 text-xs">
              
            </td>
            <td class="py-2 pr-4">
              <span class="inline-flex items-center rounded-full border border-slate-700 px-2 py-0.5 text-xs">
                
              </span>
            </td>
          ;
          body.appendChild(tr);
        }

        badge.textContent = ${filtered.length} agent(s);
      }

      try {
        agents = await ReachX.fetchTable("agents", "select=id,name,country,phone,whatsapp,status&order=country");
        render("");
      } catch (err) {
        console.error(err);
        body.innerHTML = '<tr><td colspan="4" class="py-4 text-center text-red-400 text-xs">Failed to load agents.</td></tr>';
        badge.textContent = "Error";
      }

      searchInput.addEventListener("input", (e) => render(e.target.value));
    });
  </script>
</body>
</html>
