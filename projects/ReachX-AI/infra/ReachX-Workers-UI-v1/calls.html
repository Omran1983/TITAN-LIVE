<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>ReachX Workers UI â€“ Calls Log</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="./assets/css/styles.css" />
</head>
<body class="bg-slate-950 text-slate-100">
  <header class="px-8 py-4 border-b border-slate-800 flex items-center justify-between">
    <div class="text-xl font-semibold">ReachX Workers UI</div>
    <nav class="flex gap-6 text-sm">
      <a href="./index.html">Dashboard</a>
      <a href="./employers.html">Employers</a>
      <a href="./agents.html">Agents</a>
      <a href="./dormitories.html">Dormitories</a>
      <a href="./calls.html" class="font-medium text-sky-400">Calls</a>
      <a href="./comms.html">Comms</a>
    </nav>
  </header>

  <main class="px-8 py-8 space-y-6">
    <section>
      <h1 class="text-2xl font-semibold mb-2">Calls Log</h1>
      <p class="text-slate-300 text-sm">
        Call interactions between ReachX staff, employers, agents and workers.
      </p>
    </section>

    <section class="rounded-xl border border-slate-800 bg-slate-900/60 p-4">
      <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4 mb-4">
        <input id="search" type="text" placeholder="Search by participant or summary"
               class="rounded-lg bg-slate-950/70 border border-slate-700 px-3 py-2 text-sm w-full md:w-96" />
        <span id="badge-count" class="inline-flex items-center rounded-full border border-slate-700 px-3 py-1 text-xs text-slate-400">
          Loading...
        </span>
      </div>

      <div class="overflow-x-auto">
        <table class="min-w-full text-sm">
          <thead class="border-b border-slate-800 text-slate-400 text-xs uppercase">
            <tr>
              <th class="text-left py-2 pr-4">Time</th>
              <th class="text-left py-2 pr-4">With</th>
              <th class="text-left py-2 pr-4">Direction</th>
              <th class="text-left py-2 pr-4">Summary</th>
            </tr>
          </thead>
          <tbody id="calls-body" class="divide-y divide-slate-800">
            <tr>
              <td colspan="4" class="py-4 text-center text-slate-500 text-xs">Loading calls...</td>
            </tr>
          </tbody>
        </table>
      </div>
    </section>
  </main>

  <script>window.SUPABASE_URL = "SUPABASE_URL_PLACEHOLDER"; window.SUPABASE_ANON_KEY = "SUPABASE_ANON_PLACEHOLDER";</script>
  <script src="./assets/js/reachx.js"></script>
  <script>
    document.addEventListener("DOMContentLoaded", async () => {
      const body = document.getElementById("calls-body");
      const badge = document.getElementById("badge-count");
      const searchInput = document.getElementById("search");
      let calls = [];

      function render(filter) {
        const value = (filter || "").toLowerCase();
        body.innerHTML = "";
        const filtered = calls.filter(c =>
          !value ||
          (c.party || "").toLowerCase().includes(value) ||
          (c.summary || "").toLowerCase().includes(value)
        );

        if (!filtered.length) {
          body.innerHTML = '<tr><td colspan="4" class="py-4 text-center text-slate-500 text-xs">No calls found.</td></tr>';
          badge.textContent = "0 calls";
          return;
        }

        for (const c of filtered) {
          const tr = document.createElement("tr");
          const ts = c.call_time || c.created_at || "";
          tr.innerHTML = 
            <td class="py-2 pr-4 text-xs"></td>
            <td class="py-2 pr-4"></td>
            <td class="py-2 pr-4 text-xs"></td>
            <td class="py-2 pr-4 text-xs text-slate-300"></td>
          ;
          body.appendChild(tr);
        }

        badge.textContent = ${filtered.length} call(s);
      }

      try {
        calls = await ReachX.fetchTable("calls", "select=id,call_time,party,direction,summary,created_at&order=call_time.desc");
        render("");
      } catch (err) {
        console.error(err);
        body.innerHTML = '<tr><td colspan="4" class="py-4 text-center text-red-400 text-xs">Failed to load calls.</td></tr>';
        badge.textContent = "Error";
      }

      searchInput.addEventListener("input", e => render(e.target.value));
    });
  </script>
</body>
</html>
