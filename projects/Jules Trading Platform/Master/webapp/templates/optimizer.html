{% extends "base.html" %}
{% block title %}Results{% endblock %}
{% block page_title %}Strategy Optimizer{% endblock %}

{% block content %}
<div class="holo-panel overflow-hidden flex flex-col h-full">
    <div class="p-4 border-b border-neon-cyan/30 flex justify-between items-center bg-black/40">
        <h2 class="text-neon-cyan font-bold tracking-widest text-sm flex items-center space-x-2">
            <i class="fa-solid fa-list-ol"></i>
            <span>OPTIMIZER RESULTS // STRATEGY LAB</span>
        </h2>
        <div class="text-[10px] text-neon-gold font-mono">BACKTEST DATASET</div>
    </div>

    <div class="flex-1 overflow-auto p-4">
        <table id="optimizer-table" class="w-full text-left font-mono text-xs text-gray-400">
            <thead class="text-neon-cyan border-b border-white/10 uppercase tracking-wider">
                <tr>
                    <th class="px-4 py-2">PARAMETERS</th>
                    <th class="px-4 py-2 text-center">TOTAL TRADES</th>
                    <th class="px-4 py-2 text-center">WIN RATE (%)</th>
                    <th class="px-4 py-2 text-center">PROFIT FACTOR</th>
                    <th class="px-4 py-2 text-right">TOTAL PNL</th>
                </tr>
            </thead>
            <tbody id="optimizer-body" class="divide-y divide-white/5">
                <tr>
                    <td colspan="5" class="px-4 py-8 text-center text-gray-500 italic">> SCANNING RESULTS...</td>
                </tr>
            </tbody>
        </table>
    </div>
</div>

<script>
    function loadOptimizerResults() {
        fetch('/api/optimizer_results')
            .then(response => response.json())
            .then(data => {
                const tableBody = document.getElementById('optimizer-body');
                tableBody.innerHTML = ''; // Clear existing rows

                if (!data || data.length === 0) {
                    tableBody.innerHTML = '<tr><td colspan="5" class="px-6 py-8 text-center text-gray-500 italic">No optimization results found. Run the optimizer to generate data.</td></tr>';
                    return;
                }

                data.forEach(result => {
                    const isPos = result.total_pnl >= 0;
                    const pnlClass = isPos ? 'text-green-400 font-bold' : 'text-red-400 font-bold';
                    const pnlPrefix = isPos ? '+' : '';

                    const row = `
                            <tr class="hover:bg-white/5 transition-colors group">
                                <td class="px-6 py-4 font-mono text-xs text-brand-accent break-all max-w-md">${result.parameters}</td>
                                <td class="px-6 py-4 font-mono text-center text-white">${result.total_trades}</td>
                                <td class="px-6 py-4 font-mono text-center">${result.win_rate.toFixed(1)}%</td>
                                <td class="px-6 py-4 font-mono text-center font-bold text-gray-300">${result.profit_factor.toFixed(2)}</td>
                                <td class="px-6 py-4 font-mono text-right ${pnlClass}">${pnlPrefix}$${result.total_pnl.toFixed(2)}</td>
                            </tr>
                        `;
                    tableBody.innerHTML += row;
                });
            })
            .catch(error => {
                console.error('Error fetching optimizer results:', error);
                const tableBody = document.getElementById('optimizer-body');
                tableBody.innerHTML = '<tr><td colspan="5" class="px-6 py-8 text-center text-red-400 bg-red-500/10 rounded">Error loading results.</td></tr>';
            });
    }

    loadOptimizerResults();
</script>
{% endblock %}