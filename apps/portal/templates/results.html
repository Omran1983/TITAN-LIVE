{% extends "base.html" %}

{% block content %}
<div class="bg-slate-900 min-h-screen py-12 px-4 sm:px-6 lg:px-8 flex items-center justify-center">
    <div class="max-w-3xl w-full space-y-8">

        <!-- Header Section -->
        <div class="text-center">
            <span id="region-badge"
                class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-blue-900/30 text-blue-400 border border-blue-800 mb-6">
                Analyzing Jurisdiction...
            </span>
            <h1 class="text-3xl font-extrabold text-white sm:text-4xl">
                <span id="result-title">Preliminary Assessment Complete</span>
            </h1>
            <p class="mt-4 text-lg text-slate-400">
                TITAN has analyzed your profile against <span id="protocol-count"
                    class="text-white font-bold">142</span> regulatory protocols.
            </p>
        </div>

        <!-- The Result Card -->
        <div class="bg-slate-800 rounded-2xl border border-slate-700 shadow-2xl overflow-hidden relative">
            <!-- Top Bar -->
            <div class="bg-slate-900/50 px-6 py-4 border-b border-slate-700 flex justify-between items-center">
                <span class="text-sm text-slate-400 font-mono">CASE: <span
                        class="text-white">#TITAN-25-X99</span></span>
                <span id="match-status" class="flex items-center text-green-400 text-sm font-bold">
                    <span class="w-2 h-2 bg-green-500 rounded-full mr-2 animate-pulse"></span>
                    MATCH CONFIRMED
                </span>
            </div>

            <div class="p-8 space-y-8">
                <!-- Section 1: The Find -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <div>
                        <h3 class="text-xs font-semibold text-blue-400 uppercase tracking-wider mb-2">Primary Protocol
                        </h3>
                        <p id="protocol-name" class="text-2xl font-bold text-white">Detecting...</p>
                        <p id="protocol-desc" class="text-sm text-slate-400 mt-1">...</p>
                    </div>
                    <div>
                        <h3 class="text-xs font-semibold text-blue-400 uppercase tracking-wider mb-2">Projected Value
                        </h3>
                        <div class="flex items-baseline">
                            <span id="value-amount" class="text-3xl font-extrabold text-white">...</span>
                            <span class="ml-2 text-sm text-slate-500">estimated utility</span>
                        </div>
                        <div class="mt-2 text-xs text-yellow-500 bg-yellow-900/20 px-2 py-1 rounded inline-block">
                            ‚ö†Ô∏è Subject to Manual Review
                        </div>
                    </div>
                </div>

                <!-- Section 2: Technical Breakdown -->
                <!-- Section 2: Regulatory Intelligence (The Moat) -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <!-- Widget A: Defensibility Score -->
                    <div class="bg-slate-900/50 rounded-lg p-6 border border-slate-700 relative overflow-hidden">
                        <div class="absolute top-0 right-0 p-2 opacity-10">
                            <svg class="w-24 h-24 text-blue-500" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd"
                                    d="M4 5a2 2 0 012-2 3 3 0 003 3h2a3 3 0 003-3 2 2 0 012 2v11a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3zm-3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z"
                                    clip-rule="evenodd"></path>
                            </svg>
                        </div>
                        <h4 class="text-xs font-bold text-slate-400 uppercase tracking-wider mb-2">Defensibility Score
                        </h4>
                        <div class="flex items-end">
                            <span id="score-value" class="text-5xl font-extrabold text-blue-500">...</span>
                            <span class="text-sm text-slate-500 mb-2 ml-1">/ 100</span>
                        </div>
                        <div id="score-trend" class="mt-2 text-xs font-medium">...</div>
                    </div>

                    <!-- Widget B: Peer Failure Prediction (Fear) -->
                    <div class="bg-slate-900/50 rounded-lg p-6 border border-slate-700 relative">
                        <div class="absolute top-0 right-0 p-2 opacity-10">
                            <svg class="w-24 h-24 text-red-500" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd"
                                    d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z"
                                    clip-rule="evenodd"></path>
                            </svg>
                        </div>
                        <h4 class="text-xs font-bold text-slate-400 uppercase tracking-wider mb-2">Peer Failure Risk
                        </h4>
                        <div class="flex items-end">
                            <span id="fail-rate" class="text-5xl font-extrabold text-red-500">...</span>
                            <span class="text-sm text-slate-500 mb-2 ml-1">Fail Here</span>
                        </div>
                        <p id="fail-reason" class="mt-2 text-xs text-red-300">...</p>
                    </div>
                </div>

                <!-- Section 3: The Intelligence Feed -->
                <div class="bg-slate-900/30 rounded-lg border border-slate-800 p-4 mt-4">
                    <h4 class="text-xs font-bold text-slate-500 uppercase tracking-wider mb-3">TITAN Intelligence‚Ñ¢
                        Insights</h4>
                    <ul id="analysis-list" class="space-y-3 text-sm text-slate-300">
                        <!-- Populated by JS -->
                    </ul>
                </div>
            </div>

            <!-- Section 3: The Ask (Access Gate) -->
            <div
                class="bg-gradient-to-r from-blue-900/20 to-purple-900/20 px-8 py-8 border-t border-slate-700 text-center">
                <h3 class="text-lg font-bold text-white mb-2">Unlock Implementation Plan</h3>
                <p class="text-slate-400 text-sm mb-6 max-w-lg mx-auto">
                    Get the step-by-step execution roadmap, pre-filled templates, and defense strategy for this specific
                    protocol.
                </p>

                <div class="flex flex-col sm:flex-row justify-center gap-4">
                    <button id="btn-unlock"
                        class="inline-flex justify-center items-center px-6 py-3 border border-transparent text-base font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 shadow-lg hover:shadow-blue-500/30 transition-all">
                        Unlock Now (<span id="price-tag">...</span>)
                    </button>
                    <button
                        class="inline-flex justify-center items-center px-6 py-3 border border-slate-600 text-base font-medium rounded-md text-slate-300 bg-transparent hover:bg-slate-800 transition-all">
                        Book Validation Call
                    </button>
                </div>
                <p class="mt-4 text-xs text-slate-500">
                    <span class="block">Generated by TITAN OS v2.1</span>
                    <span class="block mt-1">Strictly Confidential. Not Legal Advice.</span>
                </p>
            </div>
        </div>
    </div>
</div>

<script>
    // THE BRAIN (Mock Intelligence Engine)
    const INTELLIGENCE_DATA = {
        "UK": {
            badge: "üá¨üáß UK JURISDICTION (GBP)",
            title: "G-Cloud Readiness Assessment",
            pName: "Innovate UK Smart Grant",
            pDesc: "R&D Funding for Disruptive Innovation",
            valAmt: "¬£25,000 - ¬£500,000",
            price: "¬£500",
            score: 72,
            trend: "+14 pts vs Sector Avg",
            failRate: "42%",
            failReason: "Top Pitfall: 'Commercial Route' Definition",
            baseProb: "12%",
            titanProb: "48%",
            insights: [
                { icon: "‚ö†Ô∏è", text: "Data Governance: <strong>CRITICAL GAP</strong> (GDPR UK)", color: "text-yellow-400" },
                { icon: "‚úì", text: "Innovation Scope: <strong>High Alignment</strong> (Top 10%)", color: "text-green-400" },
                { icon: "‚Ñπ", text: "Projected Rectification Cost: <strong>¬£12,000</strong> (if ignored)", color: "text-blue-400" }
            ]
        },
        "MU": {
            badge: "üá≤üá∫ MAURITIUS JURISDICTION (MUR)",
            title: "SME Opportunity Match",
            pName: "SME Marketing Support",
            pDesc: "SME Mauritius / TINNS Refund Scheme",
            valAmt: "Rs 200,000 (Refund)",
            price: "Rs 25,000",
            score: 88,
            trend: "Top 5% of Applicants",
            failRate: "35%",
            failReason: "Top Pitfall: Tax Compliance Certificate",
            baseProb: "65%",
            titanProb: "92%",
            insights: [
                { icon: "‚úì", text: "Scheme Match: <strong>TINNS Marketing</strong>", color: "text-green-400" },
                { icon: "‚ö†Ô∏è", text: "MRA Status: <strong>Verify Clearance</strong> (High Fail Rate)", color: "text-yellow-400" },
                { icon: "‚Ñπ", text: "Estimated Refund Time: <strong>45 Days</strong>", color: "text-blue-400" }
            ]
        }
    };

    document.addEventListener("DOMContentLoaded", () => {
        const urlParams = new URLSearchParams(window.location.search);
        let region = urlParams.get('region');

        if (!region) {
            region = sessionStorage.getItem('TITAN_REGION') || 'MU';
        }

        renderResult(region);
    });

    function renderResult(region) {
        const data = INTELLIGENCE_DATA[region] || INTELLIGENCE_DATA["MU"];

        document.getElementById('region-badge').innerText = data.badge;
        document.getElementById('result-title').innerText = data.title;
        document.getElementById('protocol-name').innerText = data.pName;
        document.getElementById('protocol-desc').innerText = data.pDesc;
        document.getElementById('value-amount').innerText = data.valAmt;
        document.getElementById('price-tag').innerText = data.price;

        document.getElementById('score-value').innerText = data.score;
        document.getElementById('score-trend').innerText = data.trend;
        document.getElementById('score-trend').className = region === 'UK' ? "mt-2 text-xs font-medium text-green-400" : "mt-2 text-xs font-medium text-blue-400";

        document.getElementById('fail-rate').innerText = data.failRate;
        document.getElementById('fail-reason').innerText = data.failReason;

        const list = document.getElementById('analysis-list');
        list.innerHTML = data.insights.map(item => `
            <li class="flex items-start">
                <span class="${item.color} mr-2 font-bold">${item.icon}</span> 
                <span class="text-slate-300">${item.text}</span>
            </li>
        `).join('');

        console.log(`[TITAN-LEDGER] Intelligence Rendered. Region: ${region}. FailurePrediction: ${data.failRate}`);
    }
</script>
{% endblock %}