{% extends "base.html" %}

{% block content %}
<div class="bg-slate-900 min-h-screen py-12 px-4 sm:px-6 lg:px-8 flex items-center justify-center">
    <div class="max-w-3xl w-full space-y-8">

        <!-- Header Section -->
        <div class="text-center">
            <span id="region-badge"
                class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-blue-900/30 text-blue-400 border border-blue-800 mb-6">
                Analyzing Jurisdiction...
            </span>
            <h1 class="text-3xl font-extrabold text-white sm:text-4xl">
                <span id="result-title">Preliminary Assessment Complete</span>
            </h1>
            <p class="mt-4 text-lg text-slate-400">
                TITAN has analyzed your profile against <span id="protocol-count"
                    class="text-white font-bold">142</span> regulatory protocols.
            </p>
        </div>

        <!-- The Result Card -->
        <div class="bg-slate-800 rounded-2xl border border-slate-700 shadow-2xl overflow-hidden relative">
            <!-- Top Bar -->
            <div class="bg-slate-900/50 px-6 py-4 border-b border-slate-700 flex justify-between items-center">
                <span class="text-sm text-slate-400 font-mono">CASE: <span
                        class="text-white">#TITAN-25-X99</span></span>
                <span id="match-status" class="flex items-center text-green-400 text-sm font-bold">
                    <span class="w-2 h-2 bg-green-500 rounded-full mr-2 animate-pulse"></span>
                    MATCH CONFIRMED
                </span>
            </div>

            <div class="p-8 space-y-8">
                <!-- Section 1: The Find -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <div>
                        <h3 class="text-xs font-semibold text-blue-400 uppercase tracking-wider mb-2">Primary Protocol
                        </h3>
                        <p id="protocol-name" class="text-2xl font-bold text-white">Detecting...</p>
                        <p id="protocol-desc" class="text-sm text-slate-400 mt-1">...</p>
                    </div>
                    <div>
                        <h3 class="text-xs font-semibold text-blue-400 uppercase tracking-wider mb-2">Projected Value
                        </h3>
                        <div class="flex items-baseline">
                            <span id="value-amount" class="text-3xl font-extrabold text-white">...</span>
                            <span class="ml-2 text-sm text-slate-500">estimated utility</span>
                        </div>
                        <div class="mt-2 text-xs text-yellow-500 bg-yellow-900/20 px-2 py-1 rounded inline-block">
                            ‚ö†Ô∏è Subject to Manual Review
                        </div>
                    </div>
                </div>

                <!-- Section 2: Technical Breakdown -->
                <div class="bg-slate-900/50 rounded-lg p-6 border border-slate-700">
                    <h4 class="text-sm font-bold text-white mb-4">Readiness Analysis</h4>
                    <ul id="analysis-list" class="space-y-3 text-sm text-slate-300">
                        <!-- Populated by JS -->
                    </ul>
                </div>
            </div>

            <!-- Section 3: The Ask (Access Gate) -->
            <div
                class="bg-gradient-to-r from-blue-900/20 to-purple-900/20 px-8 py-8 border-t border-slate-700 text-center">
                <h3 class="text-lg font-bold text-white mb-2">Unlock Implementation Plan</h3>
                <p class="text-slate-400 text-sm mb-6 max-w-lg mx-auto">
                    Get the step-by-step execution roadmap, pre-filled templates, and defense strategy for this specific
                    protocol.
                </p>

                <div class="flex flex-col sm:flex-row justify-center gap-4">
                    <button id="btn-unlock"
                        class="inline-flex justify-center items-center px-6 py-3 border border-transparent text-base font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 shadow-lg hover:shadow-blue-500/30 transition-all">
                        Unlock Now (<span id="price-tag">...</span>)
                    </button>
                    <button
                        class="inline-flex justify-center items-center px-6 py-3 border border-slate-600 text-base font-medium rounded-md text-slate-300 bg-transparent hover:bg-slate-800 transition-all">
                        Book Validation Call
                    </button>
                </div>
                <p class="mt-4 text-xs text-slate-500">
                    <span class="block">Generated by TITAN OS v2.1</span>
                    <span class="block mt-1">Strictly Confidential. Not Legal Advice.</span>
                </p>
            </div>
        </div>
    </div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", () => {
        // Get Region from URL or Session
        const urlParams = new URLSearchParams(window.location.search);
        let region = urlParams.get('region');

        if (!region) {
            region = sessionStorage.getItem('TITAN_REGION') || 'MU';
        }

        renderResult(region);
    });

    function renderResult(region) {
        const badge = document.getElementById('region-badge');
        const title = document.getElementById('result-title');
        const pName = document.getElementById('protocol-name');
        const pDesc = document.getElementById('protocol-desc');
        const valAmt = document.getElementById('value-amount');
        const list = document.getElementById('analysis-list');
        const btn = document.getElementById('btn-unlock');
        const price = document.getElementById('price-tag');

        // Log the Assurance Event (Simulated)
        console.log(`[TITAN-LEDGER] Result Rendered. Region: ${region}. Event ID: ${Date.now()}`);

        if (region === 'UK') {
            // UK CONTEXT (Compliant / Readiness)
            badge.innerText = "üá¨üáß UK JURISDICTION (GBP)";
            title.innerText = "G-Cloud Readiness Assessment";
            pName.innerText = "Innovate UK Smart Grant";
            pDesc.innerText = "R&D Funding for Disruptive Innovation";
            valAmt.innerText = "¬£25,000 - ¬£500,000";

            list.innerHTML = `
                <li class="flex items-start"><span class="text-green-400 mr-2">‚úì</span> Protocol Match: High (Technological Innovation detected)</li>
                <li class="flex items-start"><span class="text-green-400 mr-2">‚úì</span> G-Cloud Alignment: Eligible for Digital Marketplace</li>
                <li class="flex items-start"><span class="text-yellow-400 mr-2">!</span> Data Governance: Manual Review Required (GDPR UK)</li>
                <li class="flex items-start"><span class="text-blue-400 mr-2">‚Ñπ</span> Defense Strategy: "Productivity Tool" Categorization</li>
            `;

            price.innerText = "¬£500";
        } else {
            // MAURITIUS CONTEXT (Grants / Opportunity)
            badge.innerText = "üá≤üá∫ MAURITIUS JURISDICTION (MUR)";
            title.innerText = "SME Opportunity Match";
            pName.innerText = "SME Marketing Support";
            pDesc.innerText = "SME Mauritius / TINNS Refund Scheme";
            valAmt.innerText = "Rs 200,000 (Refund)";

            list.innerHTML = `
                <li class="flex items-start"><span class="text-green-400 mr-2">‚úì</span> Scheme Match: Technology & Innovation Scheme (TINNS)</li>
                <li class="flex items-start"><span class="text-green-400 mr-2">‚úì</span> Refund Rate: 80% of Project Cost</li>
                <li class="flex items-start"><span class="text-green-400 mr-2">‚úì</span> Compliance: Valid BRN Structure Inferred</li>
                <li class="flex items-start"><span class="text-blue-400 mr-2">‚Ñπ</span> Next Step: Generate Supplier Quotations</li>
            `;

            price.innerText = "Rs 25,000";
        }
    }
</script>
{% endblock %}