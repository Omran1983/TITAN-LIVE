{% extends "base.html" %}

{% block content %}
<!-- White Glove Intake (Dark Theme) -->
<div class="bg-slate-900 min-h-screen flex flex-col justify-center py-12 sm:px-6 lg:px-8">
    <div class="sm:mx-auto sm:w-full sm:max-w-md">
        <div class="text-center">
            <span
                class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-900/30 text-yellow-500 border border-yellow-800 mb-4">
                ‚ö†Ô∏è DEMO MODE: MAURITIUS DATASET LOADED
            </span>
            <h2 class="text-base font-semibold text-blue-500 tracking-wide uppercase">Project Setup</h2>
            <h2 class="mt-2 text-3xl font-extrabold text-white">
                Project Auto-Generation
            </h2>
            <p class="mt-2 text-sm text-slate-400">
                You give us the basics. TITAN structures the evidence.<br>
                <span class="text-blue-400 font-semibold">5 Minutes. Zero Friction.</span>
            </p>

            <!-- CLARITY LIST -->
            <div class="mt-6 text-left bg-slate-800/80 p-4 rounded-lg border border-slate-700 mx-auto max-w-sm">
                <p class="text-xs text-slate-500 uppercase tracking-widest mb-2 font-bold">What you get:</p>
                <ul class="text-xs text-slate-300 space-y-1">
                    <li class="flex items-center"><span class="text-green-500 mr-2">‚úì</span> Project Structure (PDF)
                    </li>
                    <li class="flex items-center"><span class="text-green-500 mr-2">‚úì</span> Compliance Checklist
                        (Gov-Ready)</li>
                    <li class="flex items-center"><span class="text-green-500 mr-2">‚úì</span> Budget Template (Editable)
                    </li>
                </ul>
            </div>
        </div>
    </div>

    <div class="mt-8 sm:mx-auto sm:w-full sm:max-w-md">
        <div
            class="bg-slate-800 py-8 px-4 shadow-xl shadow-blue-900/20 sm:rounded-2xl sm:px-10 border border-slate-700">
            <form class="space-y-6" action="#" method="POST" onsubmit="event.preventDefault(); submitIntake();">

                <!-- 0. Jurisdiction (NEW) -->
                <div class="bg-slate-900/50 p-4 rounded-lg border border-slate-700">
                    <label for="jurisdiction" class="block text-sm font-medium text-blue-400 mb-2">Select
                        Jurisdiction</label>
                    <select id="jurisdiction" name="jurisdiction" onchange="updateDemoContext()"
                        class="block w-full pl-3 pr-10 py-3 text-base border-slate-600 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md bg-slate-800 text-white">
                        <option value="MU">Mauritius (MUR) - SME & Grants</option>
                        <option value="UK">United Kingdom (GBP) - Innovate UK / G-Cloud</option>
                    </select>
                </div>

                <!-- 1. Identity -->
                <div>
                    <label for="fullname" class="block text-sm font-medium text-slate-300">Full Name</label>
                    <div class="mt-1">
                        <input id="fullname" name="fullname" type="text" autocomplete="name" required
                            class="appearance-none block w-full px-3 py-3 border border-slate-600 rounded-md shadow-sm placeholder-slate-500 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm bg-slate-900 text-white"
                            placeholder="e.g. Sarah Smith">
                    </div>
                </div>

                <div>
                    <label for="nid" class="block text-sm font-medium text-slate-300">ID / Passport No.</label>
                    <div class="mt-1">
                        <input id="nid" name="nid" type="text" required
                            class="appearance-none block w-full px-3 py-3 border border-slate-600 rounded-md shadow-sm placeholder-slate-500 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm bg-slate-900 text-white"
                            placeholder="Required for Bank Checks">
                    </div>
                </div>

                <div>
                    <label for="mobile" class="block text-sm font-medium text-slate-300">Mobile Number</label>
                    <div class="mt-1">
                        <input id="mobile" name="mobile" type="tel" autocomplete="tel" required
                            class="appearance-none block w-full px-3 py-3 border border-slate-600 rounded-md shadow-sm placeholder-slate-500 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm bg-slate-900 text-white"
                            placeholder="+44 ...">
                    </div>
                </div>

                <!-- 2. Business (Optional) -->
                <div class="border-t border-slate-700 pt-6">
                    <h3 class="text-xs font-semibold text-blue-400 uppercase tracking-wider mb-4">Business Details (If
                        Any)</h3>

                    <div class="space-y-4">
                        <div>
                            <label for="company" class="block text-sm font-medium text-slate-300">Company Name <span
                                    class="text-slate-500 font-normal">(Optional)</span></label>
                            <input id="company" name="company" type="text"
                                class="appearance-none block w-full px-3 py-3 border border-slate-600 rounded-md shadow-sm placeholder-slate-500 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm bg-slate-900 text-white"
                                placeholder="Leave blank if not registered">
                        </div>

                        <div>
                            <label for="brn" class="block text-sm font-medium text-slate-300">Registration No.<span
                                    class="text-slate-500 font-normal">(Optional)</span></label>
                            <input id="brn" name="brn" type="text"
                                class="appearance-none block w-full px-3 py-3 border border-slate-600 rounded-md shadow-sm placeholder-slate-500 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm bg-slate-900 text-white"
                                placeholder="">
                        </div>
                    </div>
                </div>

                <!-- 3. The One Question -->
                <div class="border-t border-slate-700 pt-6">
                    <label for="desc" class="block text-sm font-medium text-slate-300">What does the business do? (One
                        Sentence)</label>
                    <div class="mt-1">
                        <textarea id="desc" name="desc" rows="3" required
                            class="appearance-none block w-full px-3 py-3 border border-slate-600 rounded-md shadow-sm placeholder-slate-500 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm bg-slate-900 text-white"
                            placeholder='e.g. "I manufacture clothes" or "I provide IT consultancy"'></textarea>
                    </div>
                    <p class="mt-2 text-xs text-slate-500">TITAN will infer your sector and eligible opportunities.</p>
                </div>

                <!-- 4. Consent (The Contract) -->
                <div class="flex items-start bg-blue-900/20 p-4 rounded-lg border border-blue-900/50">
                    <div class="flex items-center h-5">
                        <input id="consent" name="consent" type="checkbox" required
                            class="focus:ring-blue-500 h-4 w-4 text-blue-600 border-gray-300 rounded">
                    </div>
                    <div class="ml-3 text-sm">
                        <label for="consent" class="font-medium text-blue-300">Authorization</label>
                        <p class="text-slate-400">I allow TITAN to structure my project documentation automatically. I
                            understand this is a preparation tool, not a legal submission.</p>
                    </div>
                </div>

                <div>
                    <button type="submit"
                        class="w-full flex justify-center py-4 px-4 border border-transparent rounded-md shadow-sm text-sm font-bold text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-all hover:scale-[1.02]">
                        Generate Project Structure
                    </button>
                </div>
            </form>
        </div>

        <!-- Trust Strip -->
        <div class="mt-6 flex justify-center space-x-6 text-xs text-slate-500 grayscale opacity-50">
            <span>üîí 256-bit Encryption</span>
            <span>üõ°Ô∏è GDPR Aligned</span>
            <span>ü§ñ AI Powered</span>
        </div>
    </div>
</div>

<script>
    // Listen for Global Context Changes
    window.addEventListener('regionChanged', (e) => {
        updateDemoBanner(e.detail.region);
    });

    // Initial Load
    document.addEventListener("DOMContentLoaded", () => {
        const region = sessionStorage.getItem('TITAN_REGION') || 'MU';
        updateDemoBanner(region);
    });

    function updateDemoBanner(region) {
        const banner = document.querySelector('.bg-yellow-900\\/30');
        if (banner) {
            banner.innerText = region === 'UK' ? "‚ö†Ô∏è DEMO MODE: UK STANDARDS LOADED" : "‚ö†Ô∏è DEMO MODE: MAURITIUS DATASET LOADED";
        }
    }

    function submitIntake() {
        const btn = document.querySelector('button[type="submit"]');
        // Get Region from Session or default
        const region = sessionStorage.getItem('TITAN_REGION') || 'MU';
        const originalText = btn.innerText;

        // 1. Loading State
        btn.disabled = true;
        btn.innerHTML = `<span class="animate-pulse">üîÑ Initializing ${region} Engine...</span>`;

        // 2. Mock Process (The Experience)
        setTimeout(() => { btn.innerHTML = `<span class="animate-pulse">üìÇ Structuring Evidence (${region})...</span>`; }, 1500);
        setTimeout(() => { btn.innerHTML = `<span class="animate-pulse">üß† Inferring Market Code...</span>`; }, 3000);

        if (region === 'UK') {
            setTimeout(() => { btn.innerHTML = `<span class="animate-pulse">üõ°Ô∏è Verifying G-Cloud Protocols...</span>`; }, 4500);
        } else {
            setTimeout(() => { btn.innerHTML = `<span class="animate-pulse">üí∞ Matching Opportunities (TINNS)...</span>`; }, 4500);
        }

        // 3. Success (Redirect to Results)
        setTimeout(() => {
            // Log for Defensibility
            console.log(`[TITAN] Intake Complete. Redirecting to Results. Region: ${region}`);
            window.location.href = `/portal/results?region=${region}`;
        }, 5500);
    }
</script>
{% endblock %}
<div class="mt-1">
    <input id="fullname" name="fullname" type="text" autocomplete="name" required
        class="appearance-none block w-full px-3 py-3 border border-slate-600 rounded-md shadow-sm placeholder-slate-500 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm bg-slate-900 text-white"
        placeholder="e.g. Sarah Smith">
</div>
</div>

<div>
    <label for="nid" class="block text-sm font-medium text-slate-300">ID / Passport No.</label>
    <div class="mt-1">
        <input id="nid" name="nid" type="text" required
            class="appearance-none block w-full px-3 py-3 border border-slate-600 rounded-md shadow-sm placeholder-slate-500 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm bg-slate-900 text-white"
            placeholder="Required for Bank Checks">
    </div>
</div>

<div>
    <label for="mobile" class="block text-sm font-medium text-slate-300">Mobile Number</label>
    <div class="mt-1">
        <input id="mobile" name="mobile" type="tel" autocomplete="tel" required
            class="appearance-none block w-full px-3 py-3 border border-slate-600 rounded-md shadow-sm placeholder-slate-500 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm bg-slate-900 text-white"
            placeholder="+44 ...">
    </div>
</div>

<!-- 2. Business (Optional) -->
<div class="border-t border-slate-700 pt-6">
    <h3 class="text-xs font-semibold text-blue-400 uppercase tracking-wider mb-4">Business Details (If
        Any)</h3>

    <div class="space-y-4">
        <div>
            <label for="company" class="block text-sm font-medium text-slate-300">Company Name <span
                    class="text-slate-500 font-normal">(Optional)</span></label>
            <input id="company" name="company" type="text"
                class="appearance-none block w-full px-3 py-3 border border-slate-600 rounded-md shadow-sm placeholder-slate-500 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm bg-slate-900 text-white"
                placeholder="Leave blank if not registered">
        </div>

        <div>
            <label for="brn" class="block text-sm font-medium text-slate-300">Registration No.<span
                    class="text-slate-500 font-normal">(Optional)</span></label>
            <input id="brn" name="brn" type="text"
                class="appearance-none block w-full px-3 py-3 border border-slate-600 rounded-md shadow-sm placeholder-slate-500 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm bg-slate-900 text-white"
                placeholder="">
        </div>
    </div>
</div>

<!-- 3. The One Question -->
<div class="border-t border-slate-700 pt-6">
    <label for="desc" class="block text-sm font-medium text-slate-300">What does the business do? (One
        Sentence)</label>
    <div class="mt-1">
        <textarea id="desc" name="desc" rows="3" required
            class="appearance-none block w-full px-3 py-3 border border-slate-600 rounded-md shadow-sm placeholder-slate-500 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm bg-slate-900 text-white"
            placeholder='e.g. "I manufacture clothes" or "I provide IT consultancy"'></textarea>
    </div>
    <p class="mt-2 text-xs text-slate-500">TITAN will infer your sector and eligible opportunities.</p>
</div>

<!-- 4. Consent (The Contract) -->
<div class="flex items-start bg-blue-900/20 p-4 rounded-lg border border-blue-900/50">
    <div class="flex items-center h-5">
        <input id="consent" name="consent" type="checkbox" required
            class="focus:ring-blue-500 h-4 w-4 text-blue-600 border-gray-300 rounded">
    </div>
    <div class="ml-3 text-sm">
        <label for="consent" class="font-medium text-blue-300">Authorization</label>
        <p class="text-slate-400">I allow TITAN to structure my project documentation automatically. I
            understand this is a preparation tool, not a legal submission.</p>
    </div>
</div>

<div>
    <button type="submit"
        class="w-full flex justify-center py-4 px-4 border border-transparent rounded-md shadow-sm text-sm font-bold text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-all hover:scale-[1.02]">
        Generate Project Structure
    </button>
</div>
</form>
</div>

<!-- Trust Strip -->
<div class="mt-6 flex justify-center space-x-6 text-xs text-slate-500 grayscale opacity-50">
    <span>üîí 256-bit Encryption</span>
    <span>üõ°Ô∏è GDPR Aligned</span>
    <span>ü§ñ AI Powered</span>
</div>
</div>
</div>

<script>
    function updateDemoContext() {
        const region = document.getElementById('jurisdiction').value;
        const banner = document.querySelector('.bg-yellow-900\\/30');

        // Requirement #3: Log the Jurisdiction Choice
        console.log(`[TITAN] Jurisdiction Switch Detected: ${region}`);
        console.log(`[TITAN] Loading Regulatory Protocols: ${region === 'UK' ? 'UK_GDPR_ISO27001' : 'MU_DPA_2017'}`);

        if (banner) {
            banner.innerText = region === 'UK' ? "‚ö†Ô∏è DEMO MODE: UK STANDARDS LOADED" : "‚ö†Ô∏è DEMO MODE: MAURITIUS DATASET LOADED";
        }
    }

    function submitIntake() {
        const btn = document.querySelector('button[type="submit"]');
        const region = document.getElementById('jurisdiction').value;
        const originalText = btn.innerText;

        // 1. Loading State
        btn.disabled = true;
        btn.innerHTML = `<span class="animate-pulse">üîÑ Initializing ${region} Engine...</span>`;

        // 2. Mock Process (The Experience)
        setTimeout(() => { btn.innerHTML = `<span class="animate-pulse">üìÇ Structuring Evidence (${region})...</span>`; }, 1500);
        setTimeout(() => { btn.innerHTML = `<span class="animate-pulse">üß† Inferring Market Code...</span>`; }, 3000);

        let matchMsg = "";
        if (region === 'UK') {
            setTimeout(() => { btn.innerHTML = `<span class="animate-pulse">üõ°Ô∏è Verifying G-Cloud Protocols...</span>`; }, 4500);
            matchMsg = "TITAN READINESS REPORT (UK):\n\n- Protocol: Innovate UK Smart Grant\n- Status: Eligibility Criteria Mapped\n- Risk: Low (G-Cloud Aligned)\n- Next Step: Manual Review Recommended";
        } else {
            setTimeout(() => { btn.innerHTML = `<span class="animate-pulse">üí∞ Matching Opportunities (TINNS)...</span>`; }, 4500);
            matchMsg = "Simulated Match (Mauritius Data):\n\n- Sector: Retail/Textile\n- Opportunity: SME Grant (Marketing)\n- Refund: 80% (TINNS)\n- Next Step: Application Structuring";
        }

        // 3. Success (Redirect to 'Mock' Result or Dashboard)
        setTimeout(() => {
            alert(`‚úÖ DEMO COMPLETE: TITAN has inferred your profile.\n\n${matchMsg}`);
            btn.disabled = false;
            btn.innerText = originalText;
        }, 6000);
    }
</script>
{% endblock %}