<!doctype html>
<html>
<head>
  <meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>AOGRL Ops</title>
  <style>
    body{font-family:system-ui,Segoe UI,Arial;margin:24px;max-width:980px}
    .card{border:1px solid #ddd;border-radius:12px;padding:16px;margin-bottom:16px;box-shadow:0 1px 3px rgba(0,0,0,.04)}
    button{padding:8px 12px;border-radius:10px;border:1px solid #ccc;cursor:pointer}
    pre{background:#111;color:#0f0;padding:12px;border-radius:10px;overflow:auto;max-height:280px}
    .row{display:flex;gap:8px;flex-wrap:wrap}
    input{padding:8px;border-radius:8px;border:1px solid #ccc}
    small{color:#666}
  </style>
</head>
<body>
  <h1>üõ°Ô∏è AOGRL Ops Dashboard</h1>

  <div class="card">
    <h3>Health</h3>
    <div>HTTP: <b id="http">?</b></div>
    <div>Public URL: <a id="pub" href="#" target="_blank">...</a></div>
    <div><small id="ts"></small></div>
    <button onclick="refresh()">Refresh</button>
  </div>

  <div class="card">
    <h3>Commands</h3>
    <div class="row">
      <button onclick="run('ping')">Ping</button>
      <input id="ck" placeholder="key" />
      <input id="cv" placeholder="value" />
      <button onclick="run('cache-put',[val('ck'),val('cv')])">Cache Put</button>
      <button onclick="run('cache-get',[val('ck')])">Cache Get</button>
    </div>
    <pre id="out"></pre>
  </div>

  <div class="card">
    <h3>Logs (cloudflared tail)</h3>
    <pre id="logs"></pre>
    <button onclick="logs()">Refresh Logs</button>
  </div>

<script>
const $ = s => document.querySelector(s);
const val = id => document.getElementById(id).value;

async function refresh(){
  const r = await fetch('/api/health'); const j = await r.json();
  $('#http').textContent = j.http ? 'UP' : 'DOWN';
  $('#pub').textContent = j.public_url || '(none)';
  if (j.public_url){ $('#pub').href = j.public_url; }
  $('#ts').textContent = j.ts || '';
}
async function logs(){
  const r = await fetch('/api/logs'); const j = await r.json();
  $('#logs').textContent = (j.log||'').trim();
}
async function run(cmd,args=[]){
  const r = await fetch('/api/run',{method:'POST',headers:{'Content-Type':'application/json'},
    body: JSON.stringify({cmd, args})});
  const j = await r.json();
  $('#out').textContent = JSON.stringify(j,null,2);
}
refresh(); logs();
</script>
</body></html>